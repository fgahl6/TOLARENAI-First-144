<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>TOLARENAI — Collection</title>
<link rel="preconnect" href="https://fonts.googleapis.com">
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;800&display=swap" rel="stylesheet">
<style>
:root{--bg:#0f1115;--panel:#151922;--ink:#e9edf3;--muted:#9aa3b2;--line:#202636;--chip:#1b2230;--brand:#79c0ff}
*{box-sizing:border-box}html,body{margin:0;background:var(--bg);color:var(--ink);font-family:Inter,system-ui,Segoe UI,Roboto,Arial,sans-serif}
a{color:var(--brand);text-decoration:none}a:hover{text-decoration:underline}
.wrap{max-width:1100px;margin:0 auto;padding:28px 16px 80px}
h1{font-size:34px;margin:12px 0 4px} .muted{color:var(--muted)}
.box{background:#121620;border:1px solid var(--line);border-radius:14px;padding:16px;margin-top:16px}
table{width:100%;border-collapse:collapse}
th,td{padding:12px 10px;border-top:1px solid var(--line);vertical-align:top}
th{color:var(--muted);font-weight:600;text-align:left}
.badge{display:inline-block;padding:4px 8px;border:1px solid var(--line);border-radius:999px;color:var(--muted);font-size:12px;margin:2px 6px 2px 0}
.header{display:flex;justify-content:space-between;align-items:center;gap:12px}
</style>
</head>
<body>
  <div class="wrap">
    <a href="/" class="muted">← Back to TOLARENAI — First 144</a>
    <div class="header">
      <h1 id="title">Collection</h1>
    </div>
    <p class="muted" id="desc">Canonical entries in this collection.</p>

    <div class="box">
      <h3>Collection</h3>
      <div class="muted" style="margin:6px 0 10px">This list is rendered from <code>index.json</code> in this folder.</div>
      <div id="table-wrap"></div>
    </div>
  </div>

<script>
(function(){
  // Derive category name from folder
  const parts = location.pathname.replace(/\/+$/,'').split('/');
  const folder = parts[parts.length-1] || parts[parts.length-2];
  const nicify = s => s.replace(/_/g,' ').replace(/\b\w/g,m=>m.toUpperCase());
  const titleMap = {
    "White_Papers":"White Papers",
    "Memory_Scrolls":"Memory Scrolls",
    "Theory_Scrolls":"Theory Scrolls",
    "Whispers":"Whispers",
    "Signals":"Signal Updates"
  };
  document.getElementById('title').textContent = titleMap[folder] || nicify(folder);
  document.getElementById('desc').textContent =
    `Entries in ${titleMap[folder] || nicify(folder)} for the TOLAR REN lattice.`;

  const parseDate = o=>{
    const raw = o.date || o.published || o.timestamp || o.time;
    const d = raw ? new Date(raw) : null;
    return d && !isNaN(d) ? d : null;
  };

  const el = (tag,attrs={},children=[])=>{
    const n=document.createElement(tag);
    Object.entries(attrs).forEach(([k,v])=> n.setAttribute(k,v));
    children.forEach(c=> n.appendChild(typeof c==="string"?document.createTextNode(c):c));
    return n;
  };

  fetch('./index.json',{cache:'no-store'})
    .then(r=>r.ok?r.json():Promise.reject(r.statusText))
    .then(data=>{
      const items = Array.isArray(data.items)?data.items:[];
      // sort newest first where dates exist
      items.sort((a,b)=>{
        const da=parseDate(a), db=parseDate(b);
        if(da && db) return db - da;
        if(da && !db) return -1;
        if(!da && db) return 1;
        return 0;
      });

      const table = el('table',{},[
        el('thead',{},[el('tr',{},[
          el('th',{},['Title']),
          el('th',{},['Date']),
          el('th',{},['Tags']),
          el('th',{},['TXIDs'])
        ])]),
        el('tbody',{}, items.map(it=>{
          const title = it.title || it.name || it.label || 'Untitled';
          const url   = it.url || it.link || it.href || '#';
          const date  = parseDate(it) ? parseDate(it).toISOString().slice(0,10) : '';
          const tags  = Array.isArray(it.tags)?it.tags:[];
          const txids = [];
          if (it.txid || it.TXID) txids.push(['BSV', String(it.txid||it.TXID)]);
          if (it.txids && typeof it.txids==='object'){
            Object.entries(it.txids).forEach(([k,v])=> txids.push([k.toUpperCase(), String(v)]));
          }

          return el('tr',{},[
            el('td',{},[el('a',{href:url},[title]), it.description? el('div',{class:'muted'},[it.description]) : '']),
            el('td',{},[date]),
            el('td',{},[...tags.map(t=> el('span',{class:'badge'},[t]))]),
            el('td',{},[
              ...txids.map(([label,val])=>{
                const short = val.length>20 ? val.slice(0,12)+'…'+val.slice(-6) : val;
                if (it.txid_link || it.link){ // optional explicit link
                  return el('div',{},[label+': ', el('a',{href: it.txid_link || it.link},[short])]);
                }
                // default to a generic "link" field per chain
                const href = (it.links && it.links[label]) || it[`link_${label.toLowerCase()}`] || it.link || '#';
                return el('div',{},[label+': ', el('a',{href},[short])]);
              })
            ])
          ]);
        }))
      ]);
      document.getElementById('table-wrap').appendChild(table);
    })
    .catch(()=>{
      document.getElementById('table-wrap').innerHTML =
        '<div class="muted">No <code>index.json</code> found in this folder, or it is malformed.</div>';
    });
})();
</script>
</body>
</html>
