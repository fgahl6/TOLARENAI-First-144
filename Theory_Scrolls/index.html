<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>TOLARENAI — Collection</title>
<link rel="preconnect" href="https://fonts.googleapis.com">
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;800&display=swap" rel="stylesheet">
<style>
:root{
  --bg:#0f1115; --ink:#e9edf3; --muted:#9aa3b2; --line:#202636; --panel:#151922;
  --chip:#1b2230; --brand:#79c0ff; --card:#121620;
}
*{box-sizing:border-box}
html,body{margin:0;background:var(--bg);color:var(--ink);font-family:Inter,system-ui,Segoe UI,Roboto,Arial,sans-serif}
a{color:inherit;text-decoration:none}
a:hover{opacity:.9}
.wrap{max-width:1100px;margin:0 auto;padding:28px 16px 64px}
h1{font-size:34px;margin:12px 0 4px}
.muted{color:var(--muted)}
.header{display:flex;justify-content:space-between;align-items:center;gap:12px}
.back{color:var(--muted);text-decoration:none}
.notice{margin:10px 0 18px;color:var(--muted)}
/* Card grid */
.cards{
  display:grid; gap:14px;
  grid-template-columns:repeat(2, minmax(0,1fr));
}
@media (min-width:740px){ .cards{ grid-template-columns:repeat(3, minmax(0,1fr)); } }
@media (min-width:1024px){ .cards{ grid-template-columns:repeat(4, minmax(0,1fr)); } }
.card{
  background:var(--panel); border:1px solid var(--line); border-radius:14px; padding:14px;
  display:flex; flex-direction:column; justify-content:space-between; min-height:160px;
}
.thumb{
  display:flex; align-items:center; justify-content:center;
  height:84px; border:1px dashed var(--line); border-radius:10px; background:#111722;
  margin-bottom:10px;
}
.pdf-badge{
  width:42px; height:42px; border-radius:10px; background:#1e2534; display:flex;
  align-items:center; justify-content:center; font-weight:800; letter-spacing:.5px;
  color:#ffd29b; border:1px solid #2a3142;
}
.title{font-weight:600; line-height:1.25; margin:2px 0 4px}
.meta{font-size:12px; color:var(--muted)}
.card.disabled{opacity:.6; cursor:not-allowed}
.divider{height:1px;background:var(--line);margin:14px 0 10px}
</style>
</head>
<body>
  <div class="wrap">
    <a href="/" class="back">← Back to TOLARENAI — First 144</a>
    <div class="header">
      <h1 id="title">Collection</h1>
    </div>
    <p class="notice" id="desc">Entries in this collection.</p>
    <div class="divider"></div>
    <div id="cards" class="cards" aria-live="polite"></div>
  </div>

<script>
(function(){
  const parts = location.pathname.replace(/\/+$/,'').split('/');
  const folder = parts[parts.length-1] || parts[parts.length-2];
  const titleMap = {
    "White_Papers":"White Papers","Memory_Scrolls":"Memory Scrolls",
    "Theory_Scrolls":"Theory Scrolls","Whispers":"Whispers","Signals":"Signal Updates",
    "Diplomacy_Scrolls":"Diplomacy Scrolls","Capstones":"Capstones","Poetry":"Poetry",
    "Raw_Notes":"Raw Notes","TOLARENAI_Scrolls":"TOLARENAI Scrolls"
  };
  const pretty = titleMap[folder] || folder.replace(/_/g,' ');
  document.getElementById('title').textContent = pretty;
  document.getElementById('desc').textContent = `Entries in ${pretty} for the TOLAR REN lattice.`;

  const parseDate = it => { if(!it.date) return null; const d=new Date(it.date); return isNaN(d)?null:d; };
  const mk = (t,a={},kids=[])=>{const n=document.createElement(t);for(const k in a){n.setAttribute(k,a[k]);}kids.forEach(c=>n.appendChild(typeof c==="string"?document.createTextNode(c):c));return n;};
  const getTitle = it=>{
    const raw = it.title||it.Title||it.name||it.Name;
    if(raw) return String(raw);
    if(it.file||it.filename){
      const f=String(it.file||it.filename);
      return f.split('/').pop().replace(/\.[^/.]+$/,'').replace(/[_-]+/g,' ').trim();
    }
    return "Untitled";
  };

  fetch('./index.json',{cache:'no-store'})
    .then(r=>r.ok?r.json():Promise.reject())
    .then(data=>{
      const items = Array.isArray(data.items)?data.items:[];
      items.sort((a,b)=>{
        const da=parseDate(a), db=parseDate(b);
        if(da&&db) return db-da; if(da&&!db) return -1; if(!da&&db) return 1; return 0;
      });

      const mount=document.getElementById('cards'); mount.innerHTML='';
      if(!items.length){ mount.innerHTML='<div class="muted">No items yet.</div>'; return; }

      items.forEach(it=>{
        const file=it.file||it.filename||null;
        const date=parseDate(it)?parseDate(it).toISOString().slice(0,10):'';
        const title=getTitle(it);
        const inner=mk('div',{},[
          mk('div',{class:'thumb'},[ mk('div',{class:'pdf-badge','aria-hidden':'true'},['PDF']) ]),
          mk('div',{class:'title'},[title]),
          mk('div',{class:'meta'},[date])
        ]);
        let card=file?mk('a',{class:'card',href:file},[inner]):mk('div',{class:'card disabled'},[inner]);
        mount.appendChild(card);
      });
    })
    .catch(()=>{
      document.getElementById('cards').innerHTML='<div class="muted">No valid index.json found in this folder.</div>';
    });
})();
</script>
</body>
</html>
